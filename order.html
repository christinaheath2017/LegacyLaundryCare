<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order Details – Legacy LaundryCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff8dc;
      color: #333;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }
    h1, h2, h3 {
      text-align: center;
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .note {
      font-size: 0.9rem;
      color: #555;
      margin-top: 0.5rem;
    }
    .summary {
      background-color: #f0f8ff;
      padding: 1rem;
      border-radius: 5px;
      margin-bottom: 2rem;
    }
    .tier-box {
      background-color: #e6f2ff;
      padding: 1rem;
      border-radius: 5px;
      margin-top: 1rem;
    }
    button {
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <h1>Order Details</h1>

  <div class="summary">
    <h2>Client Info</h2>
    <p><strong>Name:</strong> <span id="clientName"></span></p>
    <p><strong>Email:</strong> <span id="clientEmail"></span></p>
    <p><strong>Phone:</strong> <span id="clientPhone"></span></p>
    <p><strong>Hotel/Motel:</strong> <span id="locationSelected"></span></p>
    <p><strong>Pickup Address:</strong> <span id="pickupAddress"></span></p>
    <p><strong>Room Number:</strong> <span id="roomNumber"></span></p>
  </div>

  <form id="orderForm" action="booking.html" method="get" onsubmit="saveOrderDetails(); return true;">

    <h2>Choose Your Service Tier</h2>
    <div class="tier-box">
      <input type="radio" name="serviceTier" value="standard" required /> <strong>Standard</strong> – $2/lb, 25 lb minimum, 24–48 hr turnaround<br />
      Includes stain treatment and hang dry options.
    </div>
    <div class="tier-box">
      <input type="radio" name="serviceTier" value="express" /> <strong>Express</strong> – $4/lb, 25 lb minimum, 60 lb max, 12–24 hr turnaround<br />
      No stain treatment or hang dry.
    </div>
    <div class="tier-box">
      <input type="radio" name="serviceTier" value="rapid" /> <strong>Rapid Express</strong> – $6/lb, 60 lb max, 6–12 hr turnaround<br />
      No stain treatment or hang dry.
    </div>

    <h2>Bag Size & Quantity</h2>
    <p>Select all bag sizes you’re using. Then tell us how many of each you have.</p>
    <div id="bagSelection">
      <label><input type="checkbox" name="bagSize" value="xs" onchange="toggleBagInput('xs')"> Extra Small (7 gal, ~10 lbs)</label>
      <input type="number" id="xsCount" placeholder="How many?" style="display:none;" min="0" />

      <label><input type="checkbox" name="bagSize" value="sm" onchange="toggleBagInput('sm')"> Small (13 gal, ~25 lbs)</label>
      <input type="number" id="smCount" placeholder="How many?" style="display:none;" min="0" />

      <label><input type="checkbox" name="bagSize" value="md" onchange="toggleBagInput('md')"> Medium (30/33 gal, ~60 lbs)</label>
      <input type="number" id="mdCount" placeholder="How many?" style="display:none;" min="0" />

      <label><input type="checkbox" name="bagSize" value="lg" onchange="toggleBagInput('lg')"> Large (40 gal, ~90 lbs)</label>
      <input type="number" id="lgCount" placeholder="How many?" style="display:none;" min="0" />

      <label><input type="checkbox" name="bagSize" value="xl" onchange="toggleBagInput('xl')"> Extra Large (55 gal, ~120 lbs)</label>
      <input type="number" id="xlCount" placeholder="How many?" style="display:none;" min="0" />
    </div>

    <h3>Sorting Options (Optional)</h3>
    <label><input type="checkbox" name="sortOption" value="delicates"> Delicates</label>
    <label><input type="checkbox" name="sortOption" value="hangDry"> Hang Dry (Standard only)</label>
    <label><input type="checkbox" name="sortOption" value="whitening"> Whitening</label>
    <div id="whiteningBagDetails" style="display:none;">
      <label for="whiteningBagSize">Which bag size needs whitening?</label>
      <select id="whiteningBagSize">
        <option value="">-- Select Size --</option>
        <option value="xs">Extra Small (~10 lbs)</option>
        <option value="sm">Small (~25 lbs)</option>
        <option value="md">Medium (~60 lbs)</option>
        <option value="lg">Large (~90 lbs)</option>
        <option value="xl">Extra Large (~120 lbs)</option>
      </select>

      <label for="whiteningBagCount">How many of that size?</label>
      <input type="number" id="whiteningBagCount" min="0" placeholder="e.g. 1 or 2" />
    </div>
    <label><input type="checkbox" name="sortOption" value="hangers"> Return on Hangers (client provides hangers)</label>

    <h2>Product Preferences</h2>
    <h3>Included Detergent (Free)</h3>
    <label><input type="radio" name="freeDetergent" value="Arm & Hammer Fresh Burst" checked /> Arm & Hammer Fresh Burst</label>
    <label><input type="radio" name="freeDetergent" value="Arm & Hammer Sensitive Skin" /> Arm & Hammer Sensitive Skin</label>

    <h3>Premium Detergents ($0.10/lb)</h3>
    <select id="premiumDetergents" multiple>
      <option value="Tide Original">Tide Original</option>
      <option value="Tide Hypoallergenic">Tide Hypoallergenic</option>
      <option value="Gain Original">Gain Original</option>
      <option value="Persil Original">Persil Original</option>
      <option value="All Free Clear">All Free Clear</option>
    </select>

    <h3>Liquid Softeners ($0.10/lb)</h3>
    <select id="liquidSofteners" multiple>
      <option value="Downy April Fresh">Downy April Fresh</option>
      <option value="Gain Original">Gain Original</option>
      <option value="All Free Clear">All Free Clear</option>
      <option value="Snuggle Blue Sparkle">Snuggle Blue Sparkle</option>
    </select>

    <h3>Dryer Sheets ($0.10/lb)</h3>
    <select id="dryerSheets" multiple>
      <option value="Bounce">Bounce</option>
      <option value="Bounce Hypoallergenic">Bounce Hypoallergenic</option>
      <option value="Gain Original">Gain Original</option>
      <option value="Downy April Fresh">Downy April Fresh</option>
      <option value="All Free Clear">All Free Clear</option>
    </select>

    <h3>Scent Boosters ($0.10/lb)</h3>
    <select id="scentBoosters" multiple>
      <option value="Downy Fresh">Downy Fresh</option>
      <option value="Arm & Hammer Fresh Burst">Arm & Hammer Fresh Burst</option>
      <option value="Gain Fireworks Original">Gain Fireworks Original</option>
    </select>

    <h3>Whitening Agents (Bag Required)</h3>
    <select id="whiteningAgents" multiple>
      <option value="Iron Out">Iron Out</option>
      <option value="Bleach">Bleach</option>
      <option value="White Out">White Out</option>
      <option value="Hydrogen Peroxide + Baking Soda">Hydrogen Peroxide + Baking Soda</option>
      <option value="OxiClean White">OxiClean White</option>
    </select>

    <h3>Color Additives</h3>
    <select id="colorAdditives" multiple>
      <option value="OxiClean Color">OxiClean Color</option>
      <option value="Color-Safe Bleach">Color-Safe Bleach</option>
      <option value="Vinegar Rinse">Vinegar Rinse</option>
    </select>

    <h3>Stain Count</h3>
    <input type="number" id="stainCount" min="0" placeholder="How many stained items?" />

    <div class="summary">
      <h2>Estimate</h2>
      <p><strong>Estimated Weight:</strong> <span id="estimatedWeight">0</span> lbs</p>
      <p><strong>Estimated Price:</strong> $<span id="estimatedPrice">0.00</span></p>
    </div>

    <button type="submit">Confirm & Continue</button>
  </form>

  <script>
    const tierRates = {
      standard: 2,
      express: 4,
      rapid: 6
    };

    const bagWeights = {
      xs: 10,
      sm: 25,
      md: 60,
      lg: 90,
      xl: 120
    };

    function toggleBagInput(size) {
      const input = document.getElementById(size + "Count");
      input.style.display = input.style.display === "none" ? "inline-block" : "none";
      input.value = "";
      calculateEstimate();
    }

    function calculateAddOnPrice(totalWeight) {
      let addonCategories = [
        "premiumDetergents",
        "liquidSofteners",
        "dryerSheets",
        "scentBoosters"
      ];
      let addonCount = 0;

      addonCategories.forEach(id => {
        const selected = Array.from(document.getElementById(id).selectedOptions);
              if (selected.length > 0) addonCount += 1;
    });

    let addonPrice = addonCount * 0.10 * totalWeight;

    // Whitening logic: uses selected bag size and count
    const whiteningSelected = document.querySelector('input[name="sortOption"][value="whitening"]')?.checked;
    let whiteningWeight = 0;
    if (whiteningSelected) {
      const size = document.getElementById("whiteningBagSize")?.value;
      const count = parseInt(document.getElementById("whiteningBagCount")?.value || "0");
      if (size && count > 0) {
        whiteningWeight = count * bagWeights[size];
        addonPrice += 0.10 * whiteningWeight;
      }
    }

    return addonPrice;
}
    return addonPrice;
  }

  function calculateEstimate() {
    let totalWeight = 0;
    ["xs", "sm", "md", "lg", "xl"].forEach(size => {
      const countInput = document.getElementById(size + "Count");
      if (countInput && countInput.style.display !== "none") {
        const count = parseInt(countInput.value || "0");
        totalWeight += count * bagWeights[size];
      }
    });

    const tier = document.querySelector('input[name="serviceTier"]:checked')?.value;
    const rate = tierRates[tier] || 0;
    const addonPrice = calculateAddOnPrice(totalWeight);
    const estimatedPrice = totalWeight * rate + addonPrice;

    document.getElementById("estimatedWeight").textContent = totalWeight;
    document.getElementById("estimatedPrice").textContent = estimatedPrice.toFixed(2);

    localStorage.setItem("estimatedWeight", totalWeight);
    localStorage.setItem("estimatedPrice", estimatedPrice.toFixed(2));
  }

  document.querySelectorAll('input[type="number"]').forEach(input => {
    input.addEventListener("input", calculateEstimate);
  });

  document.querySelectorAll('input[name="serviceTier"]').forEach(radio => {
    radio.addEventListener("change", calculateEstimate);
  });

  document.getElementById("premiumDetergents").addEventListener("change", () => {
    const premiumSelected = Array.from(document.getElementById("premiumDetergents").selectedOptions).length > 0;
    document.querySelectorAll('input[name="freeDetergent"]').forEach(radio => {
      radio.disabled = premiumSelected;
      if (premiumSelected) radio.checked = false;
    });
  });

  document.querySelector('input[name="sortOption"][value="whitening"]').addEventListener("change", (e) => {
    const show = e.target.checked;
    document.getElementById("whiteningBagDetails").style.display = show ? "block" : "none";
    if (!show) {
      document.getElementById("whiteningBagSize").value = "";
      document.getElementById("whiteningBagCount").value = "";
    }
    calculateEstimate();
  });

  function saveOrderDetails() {
    const tier = document.querySelector('input[name="serviceTier"]:checked')?.value || "";
    localStorage.setItem("serviceTier", tier);
    localStorage.setItem("freeDetergent", document.querySelector('input[name="freeDetergent"]:checked')?.value || "");
    localStorage.setItem("premiumDetergents", getMultiSelectValues("premiumDetergents"));
    localStorage.setItem("liquidSofteners", getMultiSelectValues("liquidSofteners"));
    localStorage.setItem("dryerSheets", getMultiSelectValues("dryerSheets"));
    localStorage.setItem("scentBoosters", getMultiSelectValues("scentBoosters"));
    localStorage.setItem("whiteningAgents", getMultiSelectValues("whiteningAgents"));
    localStorage.setItem("colorAdditives", getMultiSelectValues("colorAdditives"));
    localStorage.setItem("stainCount", document.getElementById("stainCount").value || "0");
    localStorage.setItem("hangDry", document.querySelector('input[name="hangDry"]')?.checked || false);
    localStorage.setItem("returnHangers", document.querySelector('input[name="returnHangers"]')?.checked || false);
    localStorage.setItem("whiteningBagSize", document.getElementById("whiteningBagSize").value || "");
    localStorage.setItem("whiteningBagCount", document.getElementById("whiteningBagCount").value || "0");
  }

  function getMultiSelectValues(id) {
    const select = document.getElementById(id);
    return Array.from(select.selectedOptions).map(opt => opt.value).join(",");
  }
</script>

</body>
</html>
