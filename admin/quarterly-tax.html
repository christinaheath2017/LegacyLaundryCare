<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quarterly Tax Estimator â€“ Legacy LaundryCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../styles.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
      color: #333;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .section {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
    }
    .button {
      background-color: #6c9bcf;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
    }
    .note {
      font-size: 0.85rem;
      color: #555;
      margin-top: 0.5rem;
      white-space: pre-line;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }
    select, input[type="number"], input[type="checkbox"] {
      padding: 0.5rem;
      margin-top: 0.5rem;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>ðŸ“† Quarterly Tax Estimator</h1>

  <div class="section">
    <h2>ðŸ’¼ Business Type</h2>
    <label for="entityType">Select Entity Type:</label>
    <select id="entityType">
      <option value="sole">Sole Proprietor</option>
      <option value="scorp">S-Corp</option>
    </select>
    <label for="salaryAmount">S-Corp Salary (if applicable):</label>
    <input type="number" id="salaryAmount" placeholder="e.g. 12000" />
  </div>

  <div class="section">
    <h2>ðŸ’¸ Estimated Quarterly Payments</h2>
    <button class="button" onclick="calculateQuarterlyTaxes()">Calculate Quarterly Taxes</button>
    <p class="note" id="quarterlySummary"></p>
    <label><input type="checkbox" id="q1Paid" /> Q1 Paid</label>
    <label><input type="checkbox" id="q2Paid" /> Q2 Paid</label>
    <label><input type="checkbox" id="q3Paid" /> Q3 Paid</label>
    <label><input type="checkbox" id="q4Paid" /> Q4 Paid</label>
  </div>

  <div class="section">
    <h2>ðŸ“¥ Export Tax Summary</h2>
    <button class="button" onclick="exportTaxSummary()">Download CSV</button>
    <p class="note">Exports taxable income, total tax, quarterly breakdown, and payment status.</p>
  </div>

  <script>
    let latestSummary = {};

    function calculateQuarterlyTaxes() {
      const entity = document.getElementById("entityType").value;
      const salary = parseFloat(document.getElementById("salaryAmount").value) || 0;

      const gross = parseFloat(localStorage.getItem("grossProfit")) || 0;
      const tips = parseFloat(localStorage.getItem("tipsReceived")) || 0;
      const exemptTips = parseFloat(localStorage.getItem("nonTaxableTips")) || 0;
      const expenses = parseFloat(localStorage.getItem("totalBusinessExpenses")) || 0;

      let taxableIncome = gross + (tips - exemptTips) - expenses;

      let salaryTaxable = taxableIncome;
      let distribution = 0;

      if (entity === "scorp") {
        salaryTaxable = salary;
        distribution = taxableIncome - salary;
      }

      const federalRate = 0.10;
      const stateRate = 0.0323;
      const countyRate = 0.0175;
      const medicareRate = 0.0145;
      const socialSecurityRate = 0.062;
      const businessTaxRate = 0.03;

      const totalTax = salaryTaxable * (federalRate + stateRate + countyRate + medicareRate + socialSecurityRate + businessTaxRate);
      const quarterlyTax = totalTax / 4;

      latestSummary = {
        entity: entity === "scorp" ? "S-Corp" : "Sole Proprietor",
        taxableIncome: taxableIncome.toFixed(2),
        salaryTaxable: salaryTaxable.toFixed(2),
        distribution: distribution.toFixed(2),
        totalTax: totalTax.toFixed(2),
        quarterlyTax: quarterlyTax.toFixed(2),
        q1Paid: document.getElementById("q1Paid").checked ? "Yes" : "No",
        q2Paid: document.getElementById("q2Paid").checked ? "Yes" : "No",
        q3Paid: document.getElementById("q3Paid").checked ? "Yes" : "No",
        q4Paid: document.getElementById("q4Paid").checked ? "Yes" : "No"
      };

      const summary = `
Entity Type: ${latestSummary.entity}
Taxable Income: $${latestSummary.taxableIncome}
S-Corp Salary Taxable: $${latestSummary.salaryTaxable}
Distribution (not taxed): $${latestSummary.distribution}
Total Estimated Tax: $${latestSummary.totalTax}

Quarterly Breakdown:
â€¢ Q1 (Apr 15): $${latestSummary.quarterlyTax} â€“ Paid: ${latestSummary.q1Paid}
â€¢ Q2 (Jun 15): $${latestSummary.quarterlyTax} â€“ Paid: ${latestSummary.q2Paid}
â€¢ Q3 (Sep 15): $${latestSummary.quarterlyTax} â€“ Paid: ${latestSummary.q3Paid}
â€¢ Q4 (Jan 15): $${latestSummary.quarterlyTax} â€“ Paid: ${latestSummary.q4Paid}
`;

      document.getElementById("quarterlySummary").textContent = summary;
    }

    function exportTaxSummary() {
      if (!latestSummary.entity) {
        alert("Please calculate taxes before exporting.");
        return;
      }

      const csvContent = `Entity Type,Taxable Income,Salary Taxable,Distribution,Total Tax,Q1 Paid,Q2 Paid,Q3 Paid,Q4 Paid
${latestSummary.entity},${latestSummary.taxableIncome},${latestSummary.salaryTaxable},${latestSummary.distribution},${latestSummary.totalTax},${latestSummary.q1Paid},${latestSummary.q2Paid},${latestSummary.q3Paid},${latestSummary.q4Paid}`;

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", "quarterly-tax-summary.csv");
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (!localStorage.getItem("grossProfit")) localStorage.setItem("grossProfit", "1200");
      if (!localStorage.getItem("tipsReceived")) localStorage.setItem("tipsReceived", "150");
      if (!localStorage.getItem("nonTaxableTips")) localStorage.setItem("nonTaxableTips", "100");
      if (!localStorage.getItem("totalBusinessExpenses")) localStorage.setItem("totalBusinessExpenses", "300");
      if (!localStorage.getItem("ownerDraw")) localStorage.setItem("ownerDraw", "400");
    });
  </script>
</body>
</html>
